# RTMP 直播自助

[TOC]

## 前言

 ![snipaste20170405_123635](.\snipaste20170405_123635.png)

如果还记得注册流程的话，应该记得注册的时候收到了验证邮件验证了邮箱，但是想直播的话还有 QQ 没有验证，没有验证怎么知道填的是不是真的呢。QQ 验证需要加 QQ 群（ 544510551 ）然后找群主私聊验证，记得让他（她）提醒你不直播时关闭首页显示。(●'◡'●)

可以在论坛的直播教程中找到直播需要用到的软件：

http://bbs.sise.com.cn/forum.php?mod=viewthread&tid=245022

 ![snipaste20170405_141938](.\snipaste20170405_141938.png)

解压 **7thlive.rar** 压缩文件，会看到 6 个项目。

已选择的 4 个项目是旧版的 OBS ，可以删掉了。

推荐使用新版的 OBS 也就是 **OBS Studio** ，因为旧版开发者已经停止维护，无法保证新硬件的兼容性，还有像内存泄露（耗尽所有内存的情况）等问题。

-

想知道后缀 .bat 文件做了什么？其实就是到这两个免安装的 OBS 文件夹里启动对应的 OBS.exe ，和直接到文件夹双击启动没区别。文件夹里 OBS 的版本号是 v0.659b ，而现在 OBS 官网的已经是 OBS Studio 18。

-

## 快速直播流程

### 启动服务器

![snipaste20170405_143755](.\snipaste20170405_143755.png)

确保文件夹所在的路径没有中文，然后双击运行 run.bat 启动服务器。

-

run.bat 文件会到 Dev-Server 文件夹找到并启动 **go-nds.exe** 这个 RTMP 服务器。

在黑色背景的命令行窗口输入 Q 关闭服务器，和在任务管理器找到 go-nds.exe 后结束任务没有区别。

我也不知道开发者们哪找到的 go-nds.exe ，请自行考虑是否使用。

### 推流端推流

![snipaste20170405_145450](.\snipaste20170405_145450.png)

安装好 OBS Studio ，记得右键**以管理员身份运行**一次。建议先把麦克风关了。

![snipaste20170405_151149](.\snipaste20170405_151149.png)

如果禁用了预览建议右键开启。

OBS Studio 怎么改黑色主题？设置 → 通用 → 主题 → Dark

#### 添加来源示例

![snipaste20170405_145951](.\snipaste20170405_145951.png)

![snipaste20170405_150343](.\snipaste20170405_150343.png)

![snipaste20170405_151205](.\snipaste20170405_151205.png)

![snipaste20170405_153026](.\snipaste20170405_153026.png)

#### 设置

![snipaste20170405_153458](.\snipaste20170405_153458.png)

URL 填上：rtmp://你的 IP 地址/live/

流密钥随意填写，意思就是想填什么填什么。

-

怎么知道自己的 IP 地址？

快捷键 `Win`+`R` ，填入 cmd ，确定后在弹出的黑色背景的命令行窗口里输入 ipconfig | findstr IPv4

-

![snipaste20170405_153526](.\snipaste20170405_153526.png)

毕竟只是推流测试，比特率先低一点设为 2500 就行。

![snipaste20170405_153544](.\snipaste20170405_153544.png)

最终输出视频的分辨率也设低点，设为 1280x720 ，FPS（帧数）设置为 24 。

以上，只做这些简单的设置，其他设置保持默认，确定后开始串流。

### 直播平台设置

![snipaste20170405_155807](.\snipaste20170405_155807.png)

串流码指的就是流密钥，翻译不同而已。

![snipaste20170405_155911](.\snipaste20170405_155911.png)

填好各项信息，选择房间封面时避免图片过大 Too Large 图垃圾！

房间密钥什么的不用管。

保存成功后，查看自己的房间是否能正常观看。记得不直播时关闭首页显示。

## 问与答

### 看不到直播？

确保服务器（ **go-nds.exe** ）的网络连接没被防火墙禁止，正常情况第一次启动软件连接网络，防火墙会弹窗询问是否允许软件连接网络。有些时候会出于不信任或手误，选择了禁止。

可以用快捷键 `Win`+`S` 搜索防火墙找到 Windows 自带的防火墙，在允许应用或功能通过 Windows 防火墙的选项中查看以及更改设置。

确保第一次启动 OBS Studio 推流时是**以管理员身份运行**，尽管没有任何资料显示的说明，但 OBS Studio 第一次启动似乎需要管理员身份运行。

确保串流地址的格式以及 IP 地址没有错误。

### 声音小？

![snipaste20170504_193913](.\snipaste20170504_193913.png)

正常情况下程序的音量会和**设备**保持一致。但是有人报告打开 OBS 后会导致音量变为 1 。

如果出现了这情况，可以在任务栏音量的图标右键找到音量合成器手动调整。

### 回音？

关掉查看自己房间时播放器的声音。递归了啊（自身调用）。

### 比特率?

数据的最小单位是 bit ，音译为比特，而 8 比特（ bit ）组成 1 Byte 也就是 1 字节。

8 比特 = 1 字节，8 bit = 1 Byte ，8 b = 1 B。都是一个意思。（注意字母 B 在大小写上的区别）

数据传输更常用比特（ bit ）作为单位，数据存储则为字节（ Byte ）。

所谓的比特率（ bitrate ）的单位是 Kbps(Kibi bit per second) 也是就是 Kb/s ，表示每秒数据量的大小。也有把这称为码率( Data Rate )。

Kibi(2^10) 是有人提议用来解决 Kilo 含义不准确的自创词。

-

已知网络带宽的上限是 100 Mbps。（1M=1024K）

如果传输音频的比特率为 320 Kbps ，传输视频的比特率为 4800 Kbps ，合计为 5120 Kbps 。

20 个连接便能占满带宽，一旦带宽开始占满，多出于带宽的数据便会丢失。

可以在任务管理的性能中实时看到网络每秒数据量的大小。

也可以查看音频媒体文件的属性，看看它们比特率的数值。

![201403291720051198](.\201403291720051198.jpg)

> 比特率数值参考，图片来自：https://www.douyu.com/cms/zhibo/201311/13/250.shtml

### 编码器？

正常情况会看到三个编码器：软件（ x264 ）、硬件（ QSV ）、硬件（ NVENC ）。（ AMD 会有不同）

x264 是开源的 H.264 编码器，结果就是 CPU 承担全部的编码工作。

QSV(Quick Sync Video) ，Intel 的快速同步视频技术，这不明所以的名字想说的就是它编码解码的速度快，和软件（ x264 ）的区别是使用了专门的硬件核心去处理数据，效率更高。

NVENC(NVIDIA Video Codec) ，英伟达视频编解码器，结果就是 GPU 也就是显卡承担全部的编码工作。

-

只有 CPU 支持 QSV 才能使用 QSV ，同理，需要保证 GPU 也就是显卡是正常可用的，才能使用 NVENC。如果选了这两个硬件进行编码发现异常，例如开始串流没反应，请使用软件编码。

现代的浏览器都会有硬件加速的功能用以加速渲染以降低 CPU ，这导致如果是软件编码去捕获浏览器窗口是黑屏的。像 Flash 播放器也是默认启用了硬件加速的。关闭了就好。

### 麦克风？

采样率越高声音越真实，当然性能要求越高。

![snipaste20170414_202748](.\snipaste20170414_202748.png)

![snipaste20170414_202943](.\snipaste20170414_202943.png)

可以使用**滤镜** → 噪音抑制，左下角添加，但声音可能变小。

### 分辨率？

基础（ Canvas ）分辨率：尽管没有翻译，Canvas（画布）所指大概就是预览那块画布，如果是 1920x1080 的分辨率，基础（ Canvas ）分辨率设置的是 1280x720 ，那画布就是 1280x720 的大小，只能通过预览看到 1280x720 大小的内容。

当然可以对来源右键变换比例适配。如果是在预览区域右键注意看来源是否是想要的。

输出（缩放）分辨率如同其字面意思，其最终结果就是观众最终看到的分辨率。如果是 1920x1080 的分辨率，最终输出分辨率是  1280x720 ，而不是 1920x1080 ，编码需求的性能会显著下降。

### 帧数，FPS 值？

尽管技术发展导致现在大多数电影是 24 帧，但也有高帧数的电影，帧数越多毫无疑问意味着更多的信息量，但考虑到带宽大小，导致实际上直播的帧数 30 帧是比较好的平衡。也需要考虑网络传输可能会丢失数据信息的情况。 

### 滤镜以及其他

和麦克风一样，右键视频来源也有滤镜，似乎经常被忽略，提供了类似区域选择，锐化等功能。

滤镜算是蛮有意思的词汇，目 → 滤 → 物。

如果添加来源为 BrowserSource ，右键来源，选项里有个交互。

-

CC BY-NC-SA 3.0 署名归属 https://github.com/stevennight/Stevennight_Live 项目

PDF 文件经由 Typora 导出。